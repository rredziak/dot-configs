# powerline

# unset kubernetes contex to be 101% sure, that powerline won't block shell looking for nonexisting k8s cluster
if [ -x /usr/bin/kubectl ] ; then
  kubectl config unset current-context > /dev/null
elif [ -x /usr/bin/minikube ] ; then
  minikube kubectl -- config unset current-context > /dev/null
fi

function _update_ps1() {
  PS1="$(/usr/bin/powerline-go -error $? -jobs $(jobs -p | wc -l) ${PWRLNOPTS})"

  # Uncomment the following line to automatically clear errors after showing
  # them once. This not only clears the error for powerline-go, but also for
  # everything else you run in that shell. Don't enable this if you're not
  # sure this is what you want.

  #set "?"
}

pythonver="python$(python -c 'import sys; print(".".join(sys.version.split()[0].split(".")[0:2]))')"
srcpline="${HOME}/.local/lib/${pythonver}/site-packages/powerline/bindings/bash/powerline.sh"


PWRLNOPTS='-colorize-hostname -cwd-max-depth 3 -modules venv,user,host,ssh,git,jobs,exit,newline,perms,dotenv,cwd,root -static-prompt-indicator'

if [ "$TERM" != "linux" ] && [ -f "/usr/bin/powerline-go" ]; then
  PROMPT_COMMAND="_update_ps1; $PROMPT_COMMAND"
elif [ -f ${srcpline} ]; then
  powerline-daemon -q
  POWERLINE_BASH_CONTINUATION=1
  POWERLINE_BASH_SELECT=1

  source ${srcpline}
fi

unset pythonver srcpline
